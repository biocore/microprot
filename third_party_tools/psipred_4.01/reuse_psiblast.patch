--- runpsipred	2016-10-02 14:44:36.000000000 -0700
+++ ../../psipred/runpsipred	2017-02-15 16:54:51.730717128 -0800
@@ -24,6 +24,12 @@
 
 set basename = $1:r
 set rootname = $basename:t
+# Stefan Janssen: We add a second parameter, which can be an elsewhere computed PSI-BLAST result for the input sequence.
+# Note that we don't check if given file actually belongs to the first input file!
+set precompBlast = $2
+if (! -e $2) then
+    set precompBlast = ""
+endif
 
 # Generate a "unique" temporary filename root
 set hostid = `hostid`
@@ -31,26 +37,32 @@
 
 \cp -f $1 $tmproot.fasta
 
-echo "Running PSI-BLAST with sequence" $1 "..."
-
-$ncbidir/blastpgp -b 0 -v 5000 -j 3 -h 0.001 -d $dbname -i $tmproot.fasta -C $tmproot.chk >& $tmproot.blast
 
-if ($status != 0) then
-    tail $tmproot.blast
-    echo "FATAL: Error whilst running blastpgp - script terminated!"
-    exit $status
-endif
+if ($precompBlast == "") then
+    echo "Running PSI-BLAST with sequence" $1 "..."
 
-echo "Predicting secondary structure..."
+    $ncbidir/blastpgp -b 0 -v 5000 -j 3 -h 0.001 -d $dbname -i $tmproot.fasta -C $tmproot.chk >& $tmproot.blast
 
-echo $tmproot.chk > $tmproot.pn
-echo $tmproot.fasta > $tmproot.sn
-
-$ncbidir/makemat -P $tmproot
-
-if ($status != 0) then
-    echo "FATAL: Error whilst running makemat - script terminated!"
-    exit $status
+    if ($status != 0) then
+        tail $tmproot.blast
+        echo "FATAL: Error whilst running blastpgp - script terminated!"
+        exit $status
+    endif
+
+    echo "Predicting secondary structure..."
+
+    echo $tmproot.chk > $tmproot.pn
+    echo $tmproot.fasta > $tmproot.sn
+
+    $ncbidir/makemat -P $tmproot
+
+    if ($status != 0) then
+        echo "FATAL: Error whilst running makemat - script terminated!"
+        exit $status
+    endif
+else
+    echo "Re-using pre-computed PSI-BLAST results ("$2") with sequence" $1 "..."
+    cp $2 $tmproot.mtx
 endif
 
 echo Pass1 ...
